{% extends 'base.html' %}

{% block title %}
{% if user.is_authenticated %}
UniColabHub - {{user.username}}
{% else %}
Username
{% endif %}
{% endblock %}

{% block content %}
<div class="row py-5 px-4">
    <div class="col-md-7 mx-auto"> <!-- Profile widget -->
        <div class="bg-white shadow rounded overflow-hidden">
            <div class="px-4 pt-4 pb-4 cover">
                <div class="media align-items-end profile-head">
                    <div class="profile mr-3">
                        <div style="display:flex; align-items: start; column-gap: 20px;">

                            <div class="dropdown">
                              <button class="btn p-0 border-0" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
                                    {% if profile.profile_pic %}
                                        <img src="{{ profile.profile_pic.url }}" alt="Profile Picture" class="rounded-circle" width="150" height="150" style="cursor: pointer; object-fit: cover;">
                                    {% else %}
                                        <img src="https://api.dicebear.com/9.x/adventurer-neutral/svg?seed=Oliver" alt="No Profile Picture" class="rounded-circle" width="150" height="150" style="cursor: pointer; object-fit: cover;">
                                    {% endif %}
                              </button>
                              <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                                <li><a class="dropdown-item" href="{% url 'user:update_profile_pic' %}">{% if profile.profile_pic.path != None %}Update{% else %}Add{% endif %}</a></li>
                                  {% if profile.profile_pic.path != None %}
                                    <li><a class="dropdown-item" href="{% url 'user:delete_profile_pic' %}">Delete</a></li>
                                  {% endif %}
                              </ul>
                            </div>


                            <div>

                                <p style="margin-bottom: 0;">@{{user.username}}</p>
                                <h4>
                                    {% if user.first_name or user.last_name %}
                                    {{user.first_name}} {{user.last_name}}
                                    {%else%}
                                    Update profile to show name
                                    {% endif %}
                                </h4>


                                <p>
                                    {% if profile.collaborator_university_id %}
                                    Reg: {{profile.collaborator_university_id}}
                                    {%else%}
                                    Update profile to show reg.
                                    {% endif %}
                                </p>
                                <a href="{% url 'user:update_profile'%}"
                                   class="btn btn-outline-dark btn-sm btn-block">Edit Profile</a>
                                <a href="{% url 'user:delete_user'%}"
                                   class="btn btn-outline-dark btn-sm btn-block">Delete Account</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="px-4 py-3">
                <h5 class="mb-0">About</h5>
                <div class="p-4 rounded shadow-sm bg-light">
                    <p class="font-italic mb-0">DOB: {{user.collabuser.collaborator_date_of_birth}}</p>
                    <p class="font-italic mb-0">About: {{user.collabuser.collaborator_about}}</p>
                </div>
            </div>
            <div class="px-4 py-3">
                <h5 class="mb-0">My Posts</h5>
                <div class="p-4 rounded shadow-sm bg-light">
                    <div class="container">
                        {% if user.is_authenticated %}

                        {% for item in feed_items %}
                          <div class="card mb-3 shadow-sm">
                              {% if item.cover_pic %}
                                <img src="{{ item.cover_pic.url }}" style="max-height: 25em; object-fit: cover;" class="card-img-top" alt="Cover image">
                              {% endif %}
                            <div class="card-body">

                                <h5 class="card-title">{{ item.title }}</h5>
                                <p class="text-muted"><i>By: {{ item.organizer.user.username }}</i></p>
                                <p class="text-black">Type: {{ item.content_type }} â€¢ Posted: {{ item.created_at|date:"M d, Y H:i" }}</p>
                                <p class="text-black">Description</p>
                                <p class="card-text">{{ item.description|truncatechars:150 }}</p>

                                <div class="d-flex">
                                    {% if item.content_type|lower == 'thesis' %}
                                        <div class="pe-3">
                                            <a href="{% url 'post:view_thesis' item.id %}" class="btn btn-primary mt-2">View {{ item.content_type }}</a>
                                        </div>

                                        {% if item.organizer.user == request.user %}
                                            <div class="pe-3">
                                                <a href="#" class="btn btn-primary mt-2">Edit {{ item.content_type }}</a>
                                            </div>

                                            <div class="pe-3">
                                                <a href="{% url 'post:delete_thesis' item.id %}" class="btn btn-primary mt-2">Delete {{ item.content_type }}</a>
                                            </div>

                                        {% endif %}
                                    {% elif item.content_type|lower == 'project' %}

                                        <div class="pe-3">
                                            <a href="{% url 'post:view_project' item.id %}" class="btn btn-primary mt-2">View {{ item.content_type }}</a>
                                        </div>
                                        {% if item.organizer.user == request.user %}

                                            <div class="pe-3">
                                                <a href="#" class="btn btn-primary mt-2">Edit {{ item.content_type }}</a>
                                            </div>

                                            <div class="pe-3">
                                                <a href="{% url 'post:delete_project' item.id %}" class="btn btn-primary mt-2">Delete {{ item.content_type }}</a>
                                            </div>
                                        {% endif %}
                                    {% elif item.content_type|lower == 'event' %}

                                        <div class="pe-3">
                                            <a href="{% url 'post:view_event' item.id %}" class="btn btn-primary mt-2">View {{ item.content_type }}</a>
                                        </div>
                                        {% if item.organizer.user == request.user %}

                                            <div class="pe-3">
                                                <a href="#" class="btn btn-primary mt-2">Edit {{ item.content_type }}</a>
                                            </div>

                                            <div class="pe-3">
                                                <a href="{% url 'post:delete_event' item.id %}" class="btn btn-primary mt-2">Delete {{ item.content_type }}</a>
                                            </div>
                                        {% endif %}
                                    {% endif %}
                                </div>

                            </div>
                          </div>
                        {% empty %}
                          <p>No posts yet.</p>
                        {% endfor %}

                        </div>
                        {% endif %}

                    </div>

                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
